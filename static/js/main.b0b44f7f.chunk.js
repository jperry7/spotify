(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t,a){},103:function(e,t,a){},105:function(e,t,a){},107:function(e,t,a){},112:function(e,t,a){},115:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(39),s=a.n(r),o=a(15),c=a(118),l=a(117),p=a(13),h=(a(14),a(42)),u=a.n(h),d=a(19),y=a.n(d),g=function(e){return function(t){return function(a){switch(a.type){case"HASHTAG_SEARCHED":var n=a.payload.hashtag.replace("#",""),i=a.payload.maxID,r="https://www.instagram.com/explore/tags/".concat(n,"/?__a=1");i&&(r="".concat(r,"&max_id=").concat(i)),y.a.get(r).then(function(t){if(200===t.status){var a=t.data.graphql.hashtag;e.dispatch({type:"HASHTAG_SEARCH_RETURNED",payload:a})}}).catch(function(t){return e.dispatch({type:"HASHTAG_SEARCH_ERRORED",payload:t})});break;default:return t(a)}}}},m=function(e){return function(t){return function(a){switch(a.type){case"VIDEO_SEARCHED":var n="https://www.instagram.com/p/".concat(a.payload.shortcode,"/?__a=1");y.a.get(n).then(function(t){200===t.status&&(a.type="VIDEO_SEARCH_RETURNED",a.payload=t.data.graphql.shortcode_media,e.dispatch(a))}).catch(function(t){return e.dispatch({type:"VIDEO_SEARCH_ERRORED",payload:t})});break;default:return t(a)}}}},k=a(25),f=a.n(k),b=function(e){return function(t){return function(a){switch(a.type){case"REFRESH_PLAYBACK":new f.a({clientId:"7c5c8668957b4b629aa5fc99e70bb4ea",accessToken:a.payload.accessToken}).getMyCurrentPlaybackState({}).then(function(t){e.dispatch({type:"REFRESH_PLAYBACK_RETURNED",payload:t.body})});break;case"GET_SPOTIFY_TRACK":new f.a({clientId:"7c5c8668957b4b629aa5fc99e70bb4ea",accessToken:a.payload.accessToken}).getAudioFeaturesForTrack(a.payload.track).then(function(t){console.log(t),e.dispatch({type:"GET_SPOTIFY_TRACK_RETURNED",payload:t.body})});break;default:return t(a)}}}},v=a(43),E=a.n(v),O=(a(99),a(3)),S=a(17),_=a.n(S),T={video_url:"https://zippy.gfycat.com/PeskyArtisticAxolotl.webm",location:{name:"Searching Instagram for videos matching hashtags..."}},j={active:new Set(["timelapse"]),inactive:new Set,hashtagData:new Map,playing:T,queued:new Set,played:new Set},A=function(e){var t=Object(O.a)(e.queued).filter(function(e){return e.video_url&&e.video_url.length}).filter(function(t){return!e.played.has(t.video_url)}).filter(function(t){return Object(O.a)(e.active).every(function(e){return t.hashtags.has(e)})});return e.active.size&&t.length?e.playing=t[0]:e.playing=T,e},w={token:{},playing:{is_playing:!1,progress_ms:1,item:{name:"",duration_ms:1}},tracks:new Map},C=Object(p.c)({hashtags:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0,a=function(e){return{active:new Set(Object(O.a)(e.active)),inactive:new Set(Object(O.a)(e.inactive)),hashtagData:new Map(e.hashtagData),playing:e.playing,queued:new Set(Object(O.a)(e.queued)),played:new Set(Object(O.a)(e.played))}}(e);switch(console.log("QUEUED VIDEOS:",a.queued.size),t.type){case"HASHTAG_ADDED":var n=t.payload.replace("#","");a.active=new Set(Object(O.a)(a.active).concat([n])),a=A(a);break;case"HASHTAG_TOGGLED":a.active.has(t.payload)?(a.inactive.add(t.payload),a.active.delete(t.payload)):(a.active.add(t.payload),a.inactive.delete(t.payload)),a=A(a);break;case"HASHTAG_SEARCH_RETURNED":a.hashtagData.set(t.payload.name,t.payload);var i=t.payload.edge_hashtag_to_media.edges.map(function(e){return e.node}).map(function(e){return function(e){return e.captions=e.edge_media_to_caption.edges.map(function(e){return e.node.text}),e.hashtags=new Set(_.a.flatten(e.captions.map(function(e){return function(e){for(var t=/(?:^|\s)(?:#)([a-zA-Z\d]+)/gm,a=[],n=t.exec(e);n;)a.push(n[1]),n=t.exec(e);return a}(e)}))),e}(e)}).filter(function(e){return e.is_video}),r=Object(O.a)(a.queued).concat(Object(O.a)(i));r.sort(function(e,t){return t.taken_at_timestamp-e.taken_at_timestamp}),a.queued=new Set(r);break;case"VIDEO_SKIPPED":case"VIDEO_ENDED":a.played=new Set(Object(O.a)(a.played).concat([a.playing.video_url])),a=A(a);break;case"VIDEO_SEARCH_RETURNED":var s=t.payload,o=Object(O.a)(a.queued);o=o.map(function(e){return e.shortcode===s.shortcode&&(e.video_url=s.video_url,e.owner=s.owner,e.location=s.location),e}),a.queued=new Set(Object(O.a)(o)),a.playing.video_url===T.video_url&&(a=A(a))}return a},playback:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0,a=function(e){return{token:e.token,playing:e.playing,tracks:new Map(e.tracks)}}(e);switch(t.type){case"SET_SPOTIFY_TOKEN":a.token=t.payload;break;case"REFRESH_PLAYBACK_RETURNED":a.playing=t.payload;break;case"GET_SPOTIFY_TRACK_RETURNED":console.log("set",t.payload),a.tracks.set(t.payload.id,t.payload)}return a},log:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return console.log("ACTION",t),e}}),D=a(6),H=a(7),I=a(9),R=a(8),P=a(10),N=a(2),U=(a(101),a(103),function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(I.a)(this,Object(R.a)(t).call(this,e))).onEnded=a.onEnded.bind(Object(N.a)(Object(N.a)(a))),a}return Object(P.a)(t,e),Object(H.a)(t,[{key:"onEnded",value:function(e){e.target.currentTime=0,e.target.play(),this.props.onEnded(this.props)}},{key:"render",value:function(){return i.a.createElement("video",{id:"VideoPlayer",className:"VideoPlayer",src:this.props.hashtags.playing.video_url,onEnded:this.onEnded,autoPlay:!0,muted:!0,playsInline:!0})}}]),t}(n.Component)),V=(a(105),a(107),a(18)),F=a(44),L=a(45);V.b.add(L.a);var G=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(I.a)(this,Object(R.a)(t).call(this,e))).DEFAULT_WIDTH="200px",a.state={value:"",width:a.DEFAULT_WIDTH},a.onChange=a.onChange.bind(Object(N.a)(Object(N.a)(a))),a.onClick=a.onClick.bind(Object(N.a)(Object(N.a)(a))),a.onKeyPress=a.onKeyPress.bind(Object(N.a)(Object(N.a)(a))),a}return Object(P.a)(t,e),Object(H.a)(t,[{key:"getWidth",value:function(e){var t=document.createElement("div");t.classList.add("hashtag"),t.innerText=e,document.getElementsByClassName("UserHashtag")[0].appendChild(t);var a=Math.max(t.offsetWidth+20,this.DEFAULT_WIDTH)+"px";return document.getElementsByClassName("UserHashtag")[0].removeChild(t),a}},{key:"sanitizeHashtag",value:function(e){var t=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],a=["0","1","2","3","4","5","6","7","8","9","0"];return 1===e.length&&"#"===e[0]?e:((e=Object(O.a)(e).filter(function(e,n){return!!t.includes(e.toLowerCase())||!!(a.includes(e)&&n>0)}).join("")).length>0&&(e="#"+e),e)}},{key:"onChange",value:function(e){this.setState({value:this.sanitizeHashtag(e.target.value),width:this.getWidth(e.target.value)})}},{key:"onClick",value:function(){this.hashtagAdded()}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.hashtagAdded()}},{key:"hashtagAdded",value:function(){this.props.hashtagAdded(this.state.value),this.setState({value:"",width:this.DEFAULT_WIDTH})}},{key:"renderSubmitButton",value:function(){return this.state.value.length>0?i.a.createElement(F.a,{icon:["fa","plus-circle"],className:"UserHashtagSubmitButton",onClick:this.onClick}):i.a.createElement("span",null)}},{key:"render",value:function(){return i.a.createElement("div",{className:"UserHashtag"},this.renderSubmitButton(),i.a.createElement("input",{type:"search",className:"UserHashtagInput",placeholder:"#hashtag",onChange:this.onChange,onKeyPress:this.onKeyPress,style:{width:this.state.width},value:this.state.value}))}}]),t}(n.Component),Y=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(I.a)(this,Object(R.a)(t).call(this,e))).onClick=a.onClick.bind(Object(N.a)(Object(N.a)(a))),a}return Object(P.a)(t,e),Object(H.a)(t,[{key:"onClick",value:function(e){var t=e.target.textContent.slice(1);this.props.hashtagToggled(t)}},{key:"renderHashtags",value:function(){var e=this;return Object(O.a)(this.props.hashtags.active).concat(Object(O.a)(this.props.hashtags.inactive)).sort().map(function(t){return e.renderHashtag(t,e.props.hashtags.active.has(t))})}},{key:"renderHashtag",value:function(e,t){var a=t?"Hashtag HashtagActive":"Hashtag HashtagInactive";return i.a.createElement("span",{className:a,key:e,onClick:this.onClick},"#",e)}},{key:"render",value:function(){return i.a.createElement("div",{className:"HashtagBar"},this.renderHashtags(),i.a.createElement(G,{hashtagAdded:this.props.hashtagAdded}))}}]),t}(n.Component),x=a(116),B=a(46),K=a.n(B),q=(a(109),a(112),function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(I.a)(this,Object(R.a)(t).call(this,e))).hashtagClicked=a.hashtagClicked.bind(Object(N.a)(Object(N.a)(a))),a.videoSkipped=a.videoSkipped.bind(Object(N.a)(Object(N.a)(a))),a.ownerClicked=a.ownerClicked.bind(Object(N.a)(Object(N.a)(a))),a}return Object(P.a)(t,e),Object(H.a)(t,[{key:"hashtagClicked",value:function(e){var t=e.target.textContent.slice(1);this.props.hashtags.active.has(t)||this.props.hashtags.inactive.has(t)?this.props.hashtagToggled(t):this.props.hashtagAdded(t)}},{key:"videoSkipped",value:function(){this.props.videoSkipped()}},{key:"renderHashtags",value:function(e){var t=this;return e?i.a.createElement("div",null,Object(O.a)(e).sort().map(function(e){return i.a.createElement("span",{key:"hashtag-"+e,className:t.props.hashtags.active.has(e)?"VideoInfoHashtag VideoInfoHashtagActive":"VideoInfoHashtag VideoInfoHashtagInactive",onClick:t.hashtagClicked},"#",e)})):i.a.createElement("span",null)}},{key:"ownerClicked",value:function(e){var t="https://www.instagram.com/".concat(this.props.hashtags.playing.owner.username,"/");window.open(t,"_blank")}},{key:"renderOwner",value:function(e){return e?i.a.createElement("div",{onClick:this.ownerClicked,className:"VideoInfoOwner"},"@",e.username):i.a.createElement("div",null)}},{key:"renderLocation",value:function(e){return e&&e.name&&e.name.length?i.a.createElement("span",{className:"VideoInfoLocation"},e.name):i.a.createElement("span",{className:"VideoInfoLocation"},"Unknown Location")}},{key:"renderTime",value:function(e){return e?i.a.createElement("span",{className:"VideoInfoTime"},i.a.createElement(K.a,{unix:!0,fromNow:!0},e)):i.a.createElement("span",null)}},{key:"renderSpotifyLoginLink",value:function(){return i.a.createElement("div",null,i.a.createElement(x.a,{to:"/login"},i.a.createElement("button",null,"Connect to Spotify")))}},{key:"renderSpotifyTrackName",value:function(){return this.props.playback.playing.item&&this.props.playback.playing.item.name?i.a.createElement("span",null,this.props.playback.playing.item.name):i.a.createElement("span",null)}},{key:"renderSpotifyAlbumName",value:function(){return this.props.playback.playing.item&&this.props.playback.playing.item.album&&this.props.playback.playing.item.album.name?i.a.createElement("span",null,this.props.playback.playing.item.album.name):i.a.createElement("span",null)}},{key:"renderSpotifyArtistName",value:function(){return this.props.playback.playing.item&&this.props.playback.playing.item.artists&&this.props.playback.playing.item.artists[0]&&this.props.playback.playing.item.artists[0]?i.a.createElement("span",null,this.props.playback.playing.item.artists[0].name):i.a.createElement("span",null)}},{key:"renderSpotifyTrackProgress",value:function(){if(!this.props.playback.playing||!this.props.playback.playing.item)return i.a.createElement("span",null);var e=this.props.playback.playing.progress_ms,t=this.props.playback.playing.item.duration_ms,a=Math.round(e/t*100);return i.a.createElement("span",null,"(",a,"%)")}},{key:"renderSpotifyTempo",value:function(){if(!this.props.playback.playing||!this.props.playback.playing.item||!this.props.playback.playing.item.id)return i.a.createElement("span",null);var e=this.props.playback.playing.item.id;if(!this.props.playback.tracks.has(e))return i.a.createElement("span",null);var t=this.props.playback.tracks.get(e);return t.tempo?i.a.createElement("span",null,Math.round(t.tempo)," beats/min, ",Math.round(100*t.danceability),"% danceability"):void 0}},{key:"renderSpotify",value:function(){return this.props.playback.token&&this.props.playback.token.length?this.props.playback.playing&&this.props.playback.playing.is_playing?i.a.createElement("div",null,i.a.createElement("div",{className:"SpotifyAlbum"},this.renderSpotifyArtistName()," - ",this.renderSpotifyAlbumName()," - ",this.renderSpotifyTrackName()," ",this.renderSpotifyTrackProgress()),i.a.createElement("div",{className:"SpotifyTempo"},this.renderSpotifyTempo())):i.a.createElement("div",{className:"SpotifyTrackName"},"No song is currently playing."):this.renderSpotifyLoginLink()}},{key:"renderSkip",value:function(){return this.props.hashtags.playing.owner?i.a.createElement("div",{className:"Skip"},i.a.createElement("button",{onClick:this.videoSkipped},"Skip Video")):i.a.createElement("span",null)}},{key:"renderVideoInfo",value:function(){var e=this.props.hashtags.playing;return e?i.a.createElement("div",null,this.renderOwner(e.owner),this.renderLocation(e.location)," ",this.renderTime(e.taken_at_timestamp),this.renderHashtags(e.hashtags),this.renderSkip(),i.a.createElement("hr",null),this.renderSpotify(),i.a.createElement("br",null),i.a.createElement("div",{className:"Author"},i.a.createElement("a",{href:"https://perry.sh"},"APP BY JOSHUA PERRY"))):i.a.createElement("div",null)}},{key:"render",value:function(){return i.a.createElement("div",{className:"VideoInfoBar"},this.renderVideoInfo())}}]),t}(n.Component)),M=5e3,W=2e3,z=1e3,J=1e3;function Q(e){return{type:"VIDEO_ENDED",payload:{hashtags:e.hashtags,queue:e.queue}}}function Z(){return{type:"VIDEO_SKIPPED"}}function $(e){return{type:"HASHTAG_ADDED",payload:e}}function X(e){return{type:"HASHTAG_TOGGLED",payload:e}}function ee(e){return{type:"HASHTAG_USER",payload:e}}function te(e){return{type:"HASHTAG_SEARCHED",payload:{hashtag:e,maxID:arguments.length>1&&void 0!==arguments[1]?arguments[1]:null},meta:{throttle:M}}}function ae(e){return{type:"VIDEO_SEARCHED",payload:{shortcode:e},meta:{throttle:W}}}function ne(e){return{type:"SET_SPOTIFY_TOKEN",payload:e}}function ie(e){return{type:"REFRESH_PLAYBACK",payload:{accessToken:e},meta:{throttle:z}}}function re(e,t){return{type:"GET_SPOTIFY_TRACK",payload:{accessToken:e,track:t},meta:{throttle:J}}}var se=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(I.a)(this,Object(R.a)(t).call(this,e))).isBeat=a.isBeat.bind(Object(N.a)(Object(N.a)(a))),a.tick=a.tick.bind(Object(N.a)(Object(N.a)(a))),a.getTempo=a.getTempo.bind(Object(N.a)(Object(N.a)(a))),a.state={beating:!1},a}return Object(P.a)(t,e),Object(H.a)(t,[{key:"componentDidMount",value:function(){this.props.hashtagSearched("timelapse"),this.tick()}},{key:"componentDidUpdate",value:function(){this.searchVideos(),this.searchHashtags(),this.refreshPlayback(),this.getSpotifyTrack()}},{key:"tick",value:function(){var e=Date.now(),t=this.getTempo(),a=document.getElementById("VideoPlayer"),n=e%t>t/2;n!=this.state.beating&&(n?(console.log("beat"),a.playbackRate=1,this.setState({beating:!0})):(a.playbackRate=0,this.setState({beating:!1}))),requestAnimationFrame(this.tick)}},{key:"getTempo",value:function(){var e=this.props.playback.playing;if(e){var t=e.item,a=e.progress_ms;if(t&&a){var n=t.id;if(n)if(this.props.playback.tracks.has(n))return 1/this.props.playback.tracks.get(n).tempo*60*1e3}}return 1}},{key:"isBeat",value:function(){var e=this.props.playback.playing;if(!e)return!1;var t=e.item,a=e.progress_ms;e.timestamp;if(!t||!a)return!1;var n=t.id;if(!n)return!1;if(!this.props.playback.tracks.has(n))return!1;var i=this.props.playback.tracks.get(n);if(!i)return!1;var r=1/i.tempo*60*1e3;return Date.now()%r<r/2}},{key:"searchVideos",value:function(){var e=this,t=Object(O.a)(this.props.hashtags.queued).filter(function(t){return Object(O.a)(e.props.hashtags.active).every(function(e){return t.hashtags.has(e)})}).filter(function(e){return!e.video_url||!e.video_url.length});if(t.length){var a=_.a.sample(t);this.props.videoSearched(a.shortcode)}}},{key:"searchHashtags",value:function(){var e=Object(O.a)(this.props.hashtags.active);if(e.length){var t=_.a.sample(e),a=null;if(this.props.hashtags.hashtagData.has(t)){var n=this.props.hashtags.hashtagData.get(t);n.edge_hashtag_to_media.page_info.has_next_page&&(a=n.edge_hashtag_to_media.page_info.end_cursor)}this.props.hashtagSearched(t,a)}}},{key:"refreshPlayback",value:function(){this.props.playback.token&&this.props.playback.token.length&&this.props.refreshPlayback(this.props.playback.token)}},{key:"getSpotifyTrack",value:function(){if(this.props.playback.token&&this.props.playback.token.length&&this.props.playback.playing&&this.props.playback.playing.item&&this.props.playback.playing.item.id){var e=this.props.playback.playing.item.id;this.props.playback.tracks.has(e)||this.props.getSpotifyTrack(this.props.playback.token,e)}}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(U,{onEnded:this.props.videoEnded,hashtags:this.props.hashtags,playback:this.props.playback,hashtagSearched:this.props.hashtagSearched,videoSearched:this.props.videoSearched}),i.a.createElement(Y,{hashtags:this.props.hashtags,hashtagAdded:this.props.hashtagAdded,hashtagToggled:this.props.hashtagToggled,hashtagUser:this.props.hashtagUser}),i.a.createElement(q,{hashtags:this.props.hashtags,playback:this.props.playback,hashtagAdded:this.props.hashtagAdded,hashtagToggled:this.props.hashtagToggled,videoSkipped:this.props.videoSkipped}))}}]),t}(n.Component),oe=Object(o.b)(function(e){return{hashtags:e.hashtags,playback:e.playback}},function(e){return Object(p.b)({videoEnded:Q,videoSkipped:Z,hashtagAdded:$,hashtagToggled:X,hashtagUser:ee,hashtagSearched:te,videoSearched:ae,refreshPlayback:ie,getSpotifyTrack:re},e)})(se),ce=function(e){function t(){var e,a;Object(D.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(I.a)(this,(e=Object(R.a)(t)).call.apply(e,[this].concat(i)))).SPOTIFY_CLIENT_ID="7c5c8668957b4b629aa5fc99e70bb4ea",a.SPOTIFY_SCOPES=["user-read-playback-state","user-read-currently-playing"],a.SPOTIFY_REDIRECT_URI="https://perry.sh/spotify/callback",a.SPOTIFY_SHOW_DIALOGUE="false",a}return Object(P.a)(t,e),Object(H.a)(t,[{key:"componentDidMount",value:function(){var e="https://accounts.spotify.com/authorize?client_id=".concat(this.SPOTIFY_CLIENT_ID,"&response_type=token&redirect_uri=").concat(this.SPOTIFY_REDIRECT_URI,"&scope=").concat(this.SPOTIFY_SCOPES.join(" "),"&show_dialog=").concat(this.SPOTIFY_SHOW_DIALOGUE);window.location.href=e}},{key:"render",value:function(){return i.a.createElement("div",null,"Redirecting to Spotify Authorization...")}}]),t}(n.Component),le=a(119),pe=function(e){function t(e){var a;return Object(D.a)(this,t),(a=Object(I.a)(this,Object(R.a)(t).call(this,e))).state={done:!1},a}return Object(P.a)(t,e),Object(H.a)(t,[{key:"componentDidMount",value:function(){var e=document.location.hash.match(/#access_token=(.*)&token_type=Bearer&expires_in=(.*)/),t=e[1];e[2];this.props.setSpotifyToken(t),this.setState({done:!0})}},{key:"render",value:function(){return this.state.done?i.a.createElement("div",null,"Redirecting after Spotify callback...",i.a.createElement(le.a,{to:{pathname:"/",state:{from:this.props.location}}})):i.a.createElement("div",null,"Redirecting after Spotify callback...")}}]),t}(n.Component),he=Object(o.b)(null,function(e){return Object(p.b)({setSpotifyToken:ne},e)})(pe);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ue=i.a.createElement(c.a,{basename:"/spotify"},i.a.createElement("div",null,i.a.createElement(l.a,{path:"/",component:oe}),i.a.createElement(l.a,{path:"/timelapse",component:oe}),i.a.createElement(l.a,{path:"/login",component:ce}),i.a.createElement(l.a,{path:"/callback",component:he}))),de=i.a.createElement(o.a,{store:Object(p.a)(u()(1e3,{leading:!0,trailing:!0}),g,m,b,E.a)(p.d)(C)},ue);s.a.render(de,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},47:function(e,t,a){e.exports=a(115)},99:function(e,t,a){}},[[47,2,1]]]);
//# sourceMappingURL=main.b0b44f7f.chunk.js.map